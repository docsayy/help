<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ABG/Vent Adjustment Helper ‚Äì Critical Care</title>
<style>
:root {
    --bg:#e0f7fa;
    --card:#ffffff;
    --accent:#00838f;
    --accent-soft:#b2ebf2;
    --muted:#546e7a;
    --danger:#d32f2f;
    --radius:14px;
}
* { box-sizing:border-box; }
body {
    margin:0;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:radial-gradient(circle at top,#b2ebf2 0,#e0f7fa 40%,#e0f2f1 100%);
    color:#102a43;
}
header {
    padding:16px;
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
    gap:8px;
    background:linear-gradient(90deg,#00acc1,#00838f);
    color:white;
}
header h1 {
    margin:0;
    font-size:1.25rem;
    display:flex;
    align-items:center;
    gap:8px;
}
.nav-buttons {
    display:flex;
    flex-wrap:wrap;
    gap:6px;
}
.nav-buttons a {
    text-decoration:none;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.8);
    color:white;
    font-size:0.9rem;
}
main {
    max-width:960px;
    margin:16px auto 32px;
    padding:0 12px;
}
.card {
    background:var(--card);
    padding:18px;
    border-radius:var(--radius);
    margin-bottom:16px;
    box-shadow:0 8px 24px rgba(0,76,92,0.18);
}
h2 {
    margin:0 0 6px;
    font-size:1.15rem;
    color:#004d5a;
}
.subtitle {
    margin:0 0 12px;
    font-size:0.9rem;
    color:var(--muted);
}
.chip {
    display:inline-flex;
    align-items:center;
    padding:3px 9px;
    border-radius:999px;
    font-size:0.75rem;
    background:var(--accent-soft);
    color:#004d40;
    font-weight:600;
}
.title-row {
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
    gap:8px;
}

/* Stepper */
.stepper {
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:8px;
    margin-bottom:14px;
}
.step-pill {
    text-align:center;
    padding:6px 4px;
    border-radius:999px;
    font-size:0.8rem;
    background:rgba(255,255,255,0.8);
    border:1px solid rgba(0,0,0,0.05);
    color:var(--muted);
}
.step-pill.active {
    background:var(--accent);
    color:white;
    font-weight:600;
}

/* Inputs */
label {
    display:block;
    font-size:0.85rem;
    margin-bottom:4px;
    color:#37474f;
}
input[type="number"],
select {
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #cfd8dc;
    font-size:0.9rem;
    background:#f9feff;
}
input[type="number"]:focus,
select:focus {
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 2px rgba(0,131,143,0.18);
    background:#ffffff;
}
.grid-2 {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
    gap:12px;
}
.section-label {
    margin:10px 0 4px;
    font-size:0.85rem;
    font-weight:600;
    color:#37474f;
}
.helper-text {
    font-size:0.8rem;
    color:var(--muted);
    margin-top:4px;
}

/* Buttons */
.buttons-row {
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
    gap:8px;
    margin-top:12px;
}
.buttons-right {
    display:flex;
    gap:8px;
    flex-wrap:wrap;
}
button {
    border-radius:999px;
    border:none;
    padding:10px 18px;
    font-size:0.9rem;
    font-weight:600;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:6px;
    white-space:nowrap;
}
.btn-secondary {
    background:#eceff1;
    color:#37474f;
}
.btn-primary {
    background:var(--accent);
    color:white;
    box-shadow:0 4px 10px rgba(0,131,143,0.4);
}
.btn-primary:hover { background:#006978; }

.hidden { display:none; }

/* Results */
.results-main {
    border-left:4px solid var(--accent);
}
.plan-box {
    background:#f5fdfd;
    border-radius:12px;
    border:1px dashed #b2ebf2;
    padding:10px 12px;
    font-size:0.86rem;
    white-space:pre-line;
    color:#37474f;
    max-height:260px;
    overflow-y:auto;
}
.results-section-title {
    font-size:0.95rem;
    font-weight:600;
    margin:10px 0 4px;
    color:#37474f;
}
.results-list {
    margin:4px 0 0;
    padding-left:18px;
    font-size:0.87rem;
    color:#455a64;
}
.results-list li { margin-bottom:3px; }

.badge-primary-type {
    background:#e0f2f1;
    color:#004d40;
    padding:4px 10px;
    border-radius:999px;
    font-size:0.9rem;
    font-weight:600;
    display:inline-flex;
    align-items:center;
    gap:6px;
}

@media (max-width:600px){
    header { flex-direction:column; align-items:flex-start; }
    .buttons-row { flex-direction:column; }
    .buttons-right { width:100%; justify-content:space-between; }
    .buttons-right button { flex:1; justify-content:center; }
}
</style>
</head>
<body>

<header>
    <h1>ü´Å ABG/Vent Adjustment Helper</h1>
    <div class="nav-buttons">
        <a href="../home.html">üè† Home</a>
        <a href="../critical.html">‚¨Ö Critical Care</a>
    </div>
</header>

<main>
    <div class="card">
        <div class="title-row">
            <h2>Gas & Vent Tuning Wizard</h2>
            <span class="chip">ABG/VBG ‚Ä¢ Vent Changes</span>
        </div>
        <p class="subtitle">
            Stepwise tool: enter blood gas, current ventilator settings, and clinical context. It suggests clear, safety-minded
            changes to RR, tidal volume, PEEP, and FiO‚ÇÇ. Does not replace your clinical judgment.
        </p>

        <div class="stepper">
            <div class="step-pill active" id="step-pill-1">1 ‚Ä¢ Gas</div>
            <div class="step-pill" id="step-pill-2">2 ‚Ä¢ Vent Settings</div>
            <div class="step-pill" id="step-pill-3">3 ‚Ä¢ Context</div>
            <div class="step-pill" id="step-pill-4">4 ‚Ä¢ Recommendations</div>
        </div>
    </div>

    <!-- STEP 1 -->
    <div class="card" id="step-1">
        <div class="title-row">
            <h2>Step 1 ‚Äì ABG / VBG Values</h2>
        </div>
        <p class="subtitle">Enter the most recent gas. VBG is acceptable; tool treats pCO‚ÇÇ numerically.</p>

        <div class="grid-2">
            <div>
                <label for="gasType">Type</label>
                <select id="gasType">
                    <option value="">Select...</option>
                    <option value="abg">ABG</option>
                    <option value="vbg">VBG</option>
                </select>
            </div>
            <div>
                <label for="ph">pH</label>
                <input type="number" step="0.01" id="ph" placeholder="e.g. 7.18">
            </div>
            <div>
                <label for="pco2">pCO‚ÇÇ (mmHg)</label>
                <input type="number" id="pco2" placeholder="e.g. 55">
            </div>
            <div>
                <label for="hco3">HCO‚ÇÉ (mEq/L)</label>
                <input type="number" id="hco3" placeholder="e.g. 18">
            </div>
            <div>
                <label for="pao2">PaO‚ÇÇ (mmHg, ABG)</label>
                <input type="number" id="pao2" placeholder="e.g. 60">
            </div>
            <div>
                <label for="spo2">SpO‚ÇÇ (%)</label>
                <input type="number" id="spo2" placeholder="e.g. 88">
            </div>
        </div>

        <p class="helper-text">
            Tool will consider metabolic acidosis if pH &lt; 7.35 and HCO‚ÇÉ &lt; 18 and use Winter‚Äôs formula to guide CO‚ÇÇ target.
        </p>

        <div class="buttons-row">
            <span></span>
            <div class="buttons-right">
                <button class="btn-primary" onclick="goToStep(2)">Next: Vent Settings ‚ûú</button>
            </div>
        </div>
    </div>

    <!-- STEP 2 -->
    <div class="card hidden" id="step-2">
        <div class="title-row">
            <h2>Step 2 ‚Äì Current Vent Settings & PBW</h2>
        </div>
        <p class="subtitle">Enter current ventilator settings and basic body size to check tidal volume safety.</p>

        <div class="grid-2">
            <div>
                <label for="ventMode">Mode</label>
                <select id="ventMode">
                    <option value="">Select...</option>
                    <option value="acvc">AC/VC (Volume Control)</option>
                    <option value="acpc">AC/PC (Pressure Control)</option>
                    <option value="prvc">PRVC / VC+</option>
                    <option value="simv">SIMV</option>
                </select>
            </div>
            <div>
                <label for="rr">Set RR (breaths/min)</label>
                <input type="number" id="rr" placeholder="e.g. 16">
            </div>
            <div>
                <label for="vt">Tidal Volume (mL)</label>
                <input type="number" id="vt" placeholder="e.g. 450">
            </div>
            <div>
                <label for="fio2Vent">FiO‚ÇÇ (%)</label>
                <input type="number" id="fio2Vent" placeholder="e.g. 80">
            </div>
            <div>
                <label for="peep">PEEP (cmH‚ÇÇO)</label>
                <input type="number" id="peepVent" placeholder="e.g. 8">
            </div>
            <div>
                <label for="gender">Gender (for PBW)</label>
                <select id="gender">
                    <option value="">Select...</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
            </div>
            <div>
                <label for="height">Height (cm)</label>
                <input type="number" id="height" placeholder="e.g. 170">
            </div>
        </div>

        <p class="helper-text">
            PBW will be used to calculate safe tidal volume ranges (ARDS 4‚Äì6 mL/kg, typical 6‚Äì8 mL/kg).
        </p>

        <div class="buttons-row">
            <button class="btn-secondary" onclick="goToStep(1)">‚¨Ö Back</button>
            <div class="buttons-right">
                <button class="btn-primary" onclick="goToStep(3)">Next: Clinical Context ‚ûú</button>
            </div>
        </div>
    </div>

    <!-- STEP 3 -->
    <div class="card hidden" id="step-3">
        <div class="title-row">
            <h2>Step 3 ‚Äì Clinical Context</h2>
        </div>
        <p class="subtitle">Context helps choose targets (PaCO‚ÇÇ, SpO‚ÇÇ, tidal volume range, PEEP strategy).</p>

        <div class="grid-2">
            <div>
                <label for="scenario">Primary Clinical Scenario</label>
                <select id="scenario">
                    <option value="">Select...</option>
                    <option value="ards">ARDS / severe hypoxemia</option>
                    <option value="copd">COPD / Asthma</option>
                    <option value="neuro">Neuro / ICP concern</option>
                    <option value="metabolic">Metabolic acidosis (DKA, lactic, etc.)</option>
                    <option value="shock">Shock (non-ARDS)</option>
                    <option value="general">General hypoxemic respiratory failure</option>
                </select>
            </div>
        </div>

        <p class="helper-text">
            Example targets:
            ARDS ‚Üí low Vt, higher PEEP; COPD ‚Üí avoid auto-PEEP, permissive hypercapnia; metabolic acidosis ‚Üí preserve
            compensatory hyperventilation.
        </p>

        <div class="buttons-row">
            <button class="btn-secondary" onclick="goToStep(2)">‚¨Ö Back</button>
            <div class="buttons-right">
                <button class="btn-primary" onclick="computeVentPlan()">Generate Recommendations ‚ûú</button>
            </div>
        </div>
    </div>

    <!-- STEP 4 / RESULTS -->
    <div class="card hidden results-main" id="step-4">
        <div class="title-row">
            <h2>Step 4 ‚Äì Vent Adjustment Recommendations</h2>
            <span class="chip">Summary & Copy Plan</span>
        </div>

        <div id="results-summary"></div>

        <div class="buttons-row">
            <button class="btn-secondary" onclick="goToStep(3)">‚¨Ö Back</button>
            <div class="buttons-right">
                <button class="btn-secondary" onclick="resetWizard()">Reset Wizard</button>
                <button class="btn-primary" onclick="copyPlan()">üìã Copy Plan</button>
            </div>
        </div>
    </div>
</main>

<script>
let lastPlanText = "";

// Navigation
function goToStep(step) {
    for (let i = 1; i <= 4; i++) {
        const card = document.getElementById("step-" + i);
        const pill = document.getElementById("step-pill-" + i);
        if (card) card.classList.add("hidden");
        if (pill) pill.classList.remove("active");
    }
    const current = document.getElementById("step-" + step);
    const pillCurrent = document.getElementById("step-pill-" + step);
    if (current) current.classList.remove("hidden");
    if (pillCurrent) pillCurrent.classList.add("active");
    window.scrollTo({ top: 0, behavior: "smooth" });
}

function readNumber(id) {
    const el = document.getElementById(id);
    if (!el) return null;
    const v = parseFloat(el.value);
    return isNaN(v) ? null : v;
}

function calcPBW(gender, height) {
    if (!gender || !height) return null;
    if (gender === "male") return 50 + 0.91 * (height - 152.4);
    return 45.5 + 0.91 * (height - 152.4);
}

function computeVentPlan() {
    // Gas
    const ph = readNumber("ph");
    const pco2 = readNumber("pco2");
    const hco3 = readNumber("hco3");
    const pao2 = readNumber("pao2");
    const spo2 = readNumber("spo2");

    // Vent
    const mode = document.getElementById("ventMode").value;
    const rr = readNumber("rr");
    const vt = readNumber("vt");
    const fio2 = readNumber("fio2Vent");
    const peep = readNumber("peepVent");
    const gender = document.getElementById("gender").value;
    const height = readNumber("height");

    const scenario = document.getElementById("scenario").value;

    const pbw = calcPBW(gender, height);

    let planLines = [];
    let rationale = [];
    let changes = [];

    // --- Baseline summary ---
    planLines.push("ABG/Vent Summary:");
    planLines.push("‚Ä¢ pH: " + (ph !== null ? ph.toFixed(2) : "not provided"));
    planLines.push("‚Ä¢ pCO‚ÇÇ: " + (pco2 !== null ? pco2.toFixed(1) + " mmHg" : "not provided"));
    planLines.push("‚Ä¢ HCO‚ÇÉ: " + (hco3 !== null ? hco3.toFixed(1) + " mEq/L" : "not provided"));
    planLines.push("‚Ä¢ PaO‚ÇÇ: " + (pao2 !== null ? pao2.toFixed(1) + " mmHg" : "not provided"));
    planLines.push("‚Ä¢ SpO‚ÇÇ: " + (spo2 !== null ? spo2.toFixed(0) + "%" : "not provided"));
    planLines.push("‚Ä¢ Mode: " + (mode || "not specified"));
    planLines.push("‚Ä¢ RR: " + (rr !== null ? rr + " /min" : "not specified"));
    planLines.push("‚Ä¢ Vt: " + (vt !== null ? vt + " mL" : "not specified"));
    planLines.push("‚Ä¢ FiO‚ÇÇ: " + (fio2 !== null ? fio2 + "%" : "not specified"));
    planLines.push("‚Ä¢ PEEP: " + (peep !== null ? peep + " cmH‚ÇÇO" : "not specified"));
    planLines.push("");

    // --- Tidal volume / PBW ---
    let vtTargetMin = null;
    let vtTargetMax = null;
    let vtRecommended = null;

    if (pbw !== null) {
        if (scenario === "ards") {
            vtTargetMin = pbw * 4;
            vtTargetMax = pbw * 6;
            vtRecommended = pbw * 6;
            rationale.push("ARDS ‚Üí prefer 4‚Äì6 mL/kg PBW tidal volumes.");
        } else {
            vtTargetMin = pbw * 6;
            vtTargetMax = pbw * 8;
            vtRecommended = pbw * 7;
            rationale.push("Non-ARDS ‚Üí typical goal 6‚Äì8 mL/kg PBW, lower if shock/overdistention risk.");
        }

        planLines.push("PBW: " + pbw.toFixed(1) + " kg");
        planLines.push("Tidal volume targets:");
        planLines.push("‚Ä¢ Min: " + vtTargetMin.toFixed(0) + " mL");
        planLines.push("‚Ä¢ Max: " + vtTargetMax.toFixed(0) + " mL");
        if (vt !== null) {
            if (vt > vtTargetMax + 20) {
                changes.push("Reduce tidal volume from " + vt.toFixed(0) + " ‚Üí ~" + vtRecommended.toFixed(0) + " mL.");
                rationale.push("Current Vt above safe range for PBW ‚Äì risk of volutrauma.");
            } else if (vt < vtTargetMin - 20) {
                changes.push("Consider increasing tidal volume towards " + vtRecommended.toFixed(0) + " mL if not in severe ARDS.");
                rationale.push("Very low Vt may cause severe hypercapnia unless intentional (e.g., ultra-protective ARDS).");
            } else {
                rationale.push("Vt already within acceptable PBW range.");
            }
        }
        planLines.push("");
    } else {
        rationale.push("PBW not available ‚Äì cannot evaluate Vt safety precisely.");
    }

    // --- CO2 / RR logic ---
    let goalCO2 = null;
    let metabolicAcidosis = false;

    if (ph !== null && hco3 !== null && ph < 7.35 && hco3 < 18) {
        metabolicAcidosis = true;
        const winter = 1.5 * hco3 + 8; // expected pCO2
        goalCO2 = winter;
        rationale.push("Metabolic acidosis: using Winter‚Äôs formula expected pCO‚ÇÇ ‚âà " + winter.toFixed(1) + " mmHg as a guide.");
    } else if (scenario === "copd") {
        goalCO2 = 45; // permissive
        rationale.push("COPD/asthma: permissive hypercapnia; pCO‚ÇÇ goal around 45‚Äì55 mmHg acceptable if pH tolerable.");
    } else if (scenario === "neuro") {
        goalCO2 = 40;
        rationale.push("Neuro/ICP: aim normocapnia (PaCO‚ÇÇ ~35‚Äì40). Avoid prolonged hyperventilation.");
    } else {
        goalCO2 = 40;
        rationale.push("Default CO‚ÇÇ goal ~40 mmHg in absence of special conditions.");
    }

    if (pco2 !== null && rr !== null && goalCO2 !== null && pco2 > 0 && goalCO2 > 0) {
        const newRRraw = rr * (pco2 / goalCO2);
        let newRR = Math.round(newRRraw);
        if (newRR < 8) newRR = 8;
        if (newRR > 35) newRR = 35;

        if (Math.abs(newRR - rr) >= 1) {
            if (newRR > rr) {
                changes.push("Increase RR from " + rr + " ‚Üí " + newRR + " breaths/min to improve CO‚ÇÇ clearance.");
            } else if (newRR < rr) {
                changes.push("Decrease RR from " + rr + " ‚Üí " + newRR + " breaths/min to avoid over-ventilation.");
            }
        } else {
            rationale.push("Current RR already close to calculated CO‚ÇÇ target.");
        }

        if (metabolicAcidosis) {
            rationale.push("Avoid dropping RR below compensatory requirement in metabolic acidosis ‚Äì do not normalize pCO‚ÇÇ to 40.");
        }
    } else {
        rationale.push("Insufficient data (RR / pCO‚ÇÇ) to recommend specific RR change.");
    }

    // --- Oxygenation / PEEP & FiO2 ---
    let lowOxy = false;
    let highOxy = false;
    let targetSpO2Low = (scenario === "copd") ? 88 : 92;
    let targetSpO2High = (scenario === "copd") ? 92 : 96;

    if ((spo2 !== null && spo2 < targetSpO2Low) || (pao2 !== null && pao2 < 60)) {
        lowOxy = true;
    }
    if (spo2 !== null && spo2 > targetSpO2High && fio2 !== null && fio2 > 60) {
        highOxy = true;
    }

    if (lowOxy && fio2 !== null && peep !== null) {
        if (scenario === "ards") {
            let newPeep = peep + 2;
            if (newPeep > 15) newPeep = 15;
            if (newPeep > peep) {
                changes.push("Increase PEEP from " + peep.toFixed(0) + " ‚Üí " + newPeep.toFixed(0) + " cmH‚ÇÇO (ARDS higher PEEP strategy).");
            }
            if (fio2 < 60) {
                changes.push("Increase FiO‚ÇÇ from " + fio2.toFixed(0) + "% ‚Üí 60‚Äì80% while titrating PEEP.");
            } else if (fio2 < 100) {
                changes.push("Consider FiO‚ÇÇ escalation towards 100% if severe hypoxemia persists despite PEEP.");
            }
            rationale.push("ARDS + hypoxemia ‚Üí prioritize PEEP ladder and ensure adequate FiO‚ÇÇ.");
        } else {
            if (fio2 < 60) {
                changes.push("Increase FiO‚ÇÇ from " + fio2.toFixed(0) + "% ‚Üí 60‚Äì100% for hypoxemia.");
            } else {
                let newPeep = peep + 2;
                if (newPeep > 15) newPeep = 15;
                if (newPeep > peep) {
                    changes.push("Increase PEEP from " + peep.toFixed(0) + " ‚Üí " + newPeep.toFixed(0) + " cmH‚ÇÇO to improve oxygenation.");
                }
            }
            rationale.push("Hypoxemia detected ‚Üí increase FiO‚ÇÇ first, then PEEP as needed.");
        }
    } else if (highOxy && fio2 !== null) {
        const newFiO2 = Math.max(40, fio2 - 10);
        if (newFiO2 < fio2) {
            changes.push("Wean FiO‚ÇÇ from " + fio2.toFixed(0) + "% ‚Üí ~" + newFiO2.toFixed(0) + "% while maintaining target SpO‚ÇÇ.");
            rationale.push("SpO‚ÇÇ high on high FiO‚ÇÇ ‚Üí reduce oxygen to avoid oxygen toxicity.");
        }
    }

    if (!lowOxy && !highOxy && (spo2 !== null || pao2 !== null)) {
        rationale.push("Oxygenation appears acceptable for now ‚Äì avoid unnecessary FiO‚ÇÇ/PEEP changes.");
    }

    // --- Scenario-specific notes ---
    switch (scenario) {
        case "copd":
            rationale.push("COPD/asthma: ensure long expiratory time (low RR, higher flow) and monitor for auto-PEEP.");
            break;
        case "neuro":
            rationale.push("Neuro: avoid significant hypo- or hypercapnia; maintain stable PaCO‚ÇÇ and avoid hypoxia.");
            break;
        case "shock":
            rationale.push("Shock: avoid excessively high PEEP that may reduce preload; use moderate PEEP and low Vt.");
            break;
        case "ards":
            rationale.push("ARDS: consider prone positioning if P/F ratio is poor; strictly limit plateau pressure.");
            break;
        case "metabolic":
            rationale.push("Metabolic acidosis: support compensatory hyperventilation; avoid abrupt RR reduction.");
            break;
        default:
            break;
    }

    if (changes.length === 0) {
        changes.push("No major automatic changes computed ‚Äì reassess clinically, consider small incremental adjustments instead of large jumps.");
    }

    // --- Build final plan text ---
    planLines.push("RECOMMENDED VENT ADJUSTMENTS:");
    changes.forEach(c => planLines.push("‚Ä¢ " + c));
    planLines.push("");
    planLines.push("KEY RATIONALE / NOTES:");
    rationale.forEach(r => planLines.push("‚Ä¢ " + r));

    lastPlanText = planLines.join("\n");

    // Build HTML
    let rationaleHtml = "<ul class='results-list'>";
    rationale.forEach(r => rationaleHtml += "<li>" + r + "</li>");
    rationaleHtml += "</ul>";

    let changesHtml = "<ul class='results-list'>";
    changes.forEach(c => changesHtml += "<li>" + c + "</li>");
    changesHtml += "</ul>";

    const resultsDiv = document.getElementById("results-summary");
    resultsDiv.innerHTML =
        "<div class='results-section-title'>Suggested vent changes</div>" +
        "<div class='badge-primary-type'>ABG-guided adjustment for scenario: " + (scenario || "not specified") + "</div>" +
        "<div class='results-section-title'>Change summary</div>" +
        changesHtml +
        "<div class='results-section-title'>Why these changes?</div>" +
        rationaleHtml +
        "<div class='results-section-title'>Full plan (editable then copy)</div>" +
        "<div class='plan-box' id='plan-box'>" +
        lastPlanText.replace(/\n/g,"<br>") +
        "</div>" +
        "<p class='helper-text'>This tool is for decision support and education; always confirm with your clinical judgment, ventilator graphics, and local protocols.</p>";

    goToStep(4);
}

function copyPlan() {
    if (!lastPlanText) {
        alert("No plan to copy yet. Generate a plan first.");
        return;
    }
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(lastPlanText)
            .then(() => alert("Vent plan copied to clipboard."))
            .catch(() => fallbackCopy());
    } else {
        fallbackCopy();
    }
}

function fallbackCopy() {
    const temp = document.createElement("textarea");
    temp.value = lastPlanText;
    document.body.appendChild(temp);
    temp.select();
    try {
        document.execCommand("copy");
        alert("Vent plan copied to clipboard.");
    } catch (e) {
        alert("Could not copy automatically. Please select and copy manually.");
    }
    document.body.removeChild(temp);
}

function resetWizard() {
    const inputs = document.querySelectorAll("input[type='number']");
    inputs.forEach(i => i.value = "");
    const selects = document.querySelectorAll("select");
    selects.forEach(s => s.value = "");
    lastPlanText = "";
    document.getElementById("results-summary").innerHTML = "";
    goToStep(1);
}
</script>

</body>
</html>
