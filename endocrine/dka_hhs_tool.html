<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DKA / HHS Rapid Assessment & Management</title>

<style>
    :root {
        --primary: #9b5de5;      /* Endocrine violet */
        --secondary: #f7c948;    /* Gold accent */
        --bg1: #fdf7ff;
        --bg2: #f3eaff;
        --card-bg: #ffffff;
        --text: #3a2a4c;
        --radius: 14px;
        --pad: 14px;
    }

    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, var(--bg1), var(--bg2));
        padding: 20px;
        color: var(--text);
    }

    h1 {
        text-align: center;
        color: var(--primary);
        font-size: 28px;
        margin-bottom: 20px;
    }

    .card {
        background: var(--card-bg);
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        max-width: 600px;
        margin: 0 auto 25px auto;
    }

    label {
        font-weight: bold;
        display: block;
        margin-top: 12px;
    }

    input, select {
        width: 100%;
        padding: 10px;
        border-radius: var(--radius);
        border: 1px solid #ccc;
        margin-top: 5px;
        font-size: 16px;
    }

    .checkbox-group {
        margin-top: 10px;
    }

    .checkbox-group label {
        font-weight: normal;
        display: flex;
        align-items: center;
        margin-top: 6px;
    }

    button {
        width: 100%;
        padding: 14px;
        margin-top: 20px;
        background: var(--primary);
        color: white;
        font-size: 18px;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        transition: 0.2s;
    }

    button:hover {
        background: #8649d6;
    }

    h2 {
        color: var(--primary);
        margin-top: 20px;
    }

    .output {
        white-space: pre-line;
        padding: 15px;
        background: #fff7e6;
        border-left: 5px solid var(--secondary);
        border-radius: var(--radius);
        margin-top: 10px;
    }

    .nav-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 25px;
    }

    .nav-buttons a {
        text-decoration: none;
        background: var(--secondary);
        padding: 10px 14px;
        border-radius: var(--radius);
        color: #5b440b;
        font-weight: bold;
        box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }
</style>
</head>

<body>

<h1>DKA / HHS Rapid Assessment & Management</h1>

<div class="card">

    <h3 style="color:var(--primary)">Patient Values</h3>

    <label>pH</label>
    <input id="ph" type="number" step="0.01">

    <label>pCO₂ (mmHg)</label>
    <input id="pco2" type="number">

    <label>HCO₃⁻ (mEq/L)</label>
    <input id="hco3" type="number">

    <label>Glucose (mg/dL)</label>
    <input id="glucose" type="number">

    <label>Sodium (mEq/L)</label>
    <input id="na" type="number">

    <label>Chloride (mEq/L)</label>
    <input id="cl" type="number">

    <label>Potassium (mEq/L)</label>
    <input id="k" type="number" step="0.1">

    <label>BHB (β-hydroxybutyrate, mmol/L)</label>
    <input id="bhb" type="number" step="0.1">

    <label>Serum Osmolality</label>
    <input id="osm" type="number">

    <label>Albumin (optional)</label>
    <input id="albumin" type="number" step="0.1">

    <hr style="margin-top:20px">

    <h3 style="color:var(--primary)">Current Treatment</h3>

    <label>Current Insulin:</label>
    <select id="insulin">
        <option value="none">No insulin running</option>
        <option value="0.1">Insulin infusion 0.1 units/kg/hr</option>
        <option value="0.05">Insulin infusion 0.05 units/kg/hr</option>
    </select>

    <label style="margin-top:14px;">IV Fluids Currently Running:</label>
    <div class="checkbox-group">
        <label><input type="checkbox" id="iv_ns"> Normal Saline (NS)</label>
        <label><input type="checkbox" id="iv_lr"> Lactated Ringer’s (LR)</label>
        <label><input type="checkbox" id="iv_d5"> D5W</label>
        <label><input type="checkbox" id="iv_d5half"> D5 0.45% NS</label>
        <label><input type="checkbox" id="iv_half"> 0.45% NS</label>
        <label><input type="checkbox" id="iv_bicarb"> Sodium Bicarbonate Infusion</label>
    </div>

    <button onclick="calculateDKA()">Assess</button>

    <h2>Recommendations</h2>
    <div id="recommendations" class="output"></div>

    <h2>Assessment</h2>
    <div id="assessment" class="output"></div>

    <h2>Key Labs</h2>
    <div id="keylabs" class="output"></div>

    <h2>Copy to Clipboard</h2>
    <button onclick="copyPlan()">Copy A/P</button>
    <div id="copytext" class="output"></div>

    <div class="nav-buttons">
        <a href="index.html">Home</a>
        <a href="endocrine_emergencies.html">Back to Endocrine</a>
    </div>

</div>

<script>
function calculateDKA() {

    let ph = parseFloat(document.getElementById("ph").value);
    let pco2 = parseFloat(document.getElementById("pco2").value);
    let hco3 = parseFloat(document.getElementById("hco3").value);
    let glucose = parseFloat(document.getElementById("glucose").value);
    let na = parseFloat(document.getElementById("na").value);
    let cl = parseFloat(document.getElementById("cl").value);
    let k = parseFloat(document.getElementById("k").value);
    let bhb = parseFloat(document.getElementById("bhb").value);
    let osm = parseFloat(document.getElementById("osm").value);
    let alb = parseFloat(document.getElementById("albumin").value);

    let insulin = document.getElementById("insulin").value;

    let ag = na - (cl + hco3);
    let cag = alb ? ag + 2.5 * (4 - alb) : ag;

    // DKA / HHS classification
    let assessmentText = "";
    if (ph < 7.3 && hco3 < 18 && bhb > 3) {
        assessmentText = "DKA physiology (acidosis + ketosis).";
    }
    if (osm > 320 && hco3 > 18 && ph > 7.3) {
        assessmentText = "HHS physiology (very high glucose + hyperosmolar state).";
    }
    if (osm > 320 && hco3 < 18) {
        assessmentText = "Mixed DKA + HHS physiology.";
    }

    // Recommendations generator
    let rec = [];

    rec.push("• Start isotonic fluid resuscitation unless contraindicated.");
    rec.push("• LR or NS 1–1.5 L in the first hour.");

    if (k < 3.3) {
        rec.push("• K <3.3 → REPLACE BEFORE insulin.");
    } else if (k >= 3.3 && k <= 5.2) {
        rec.push("• Add 20–30 mEq KCl to each liter of fluid.");
    } else {
        rec.push("• Hold potassium replacement initially; monitor closely.");
    }

    if (insulin === "none") {
        rec.push("• Start insulin infusion (0.1 units/kg/hr).");
    } else if (insulin === "0.05") {
        rec.push("• Patient already receiving low-dose insulin. Ensure glucose is falling appropriately.");
    } else {
        rec.push("• Patient already receiving 0.1 units/kg/hr insulin.");
    }

    if (glucose < 250) {
        rec.push("• Add D5 to fluids once glucose <250 mg/dL.");
    }

    if (ph < 6.9) {
        rec.push("• Consider bicarbonate infusion ONLY in severe acidemia (ICU).");
    }

    // Key labs
    let labs = `AG: ${ag.toFixed(1)}
Corrected AG: ${cag.toFixed(1)}
pH: ${ph}
BHB: ${bhb}
Osm: ${osm}
Glucose: ${glucose}
Potassium: ${k}`;

    // Copy text
    let copy = rec.join("\n") + "\n\nAssessment: " + assessmentText;

    document.getElementById("recommendations").innerText = rec.join("\n");
    document.getElementById("assessment").innerText = assessmentText;
    document.getElementById("keylabs").innerText = labs;
    document.getElementById("copytext").innerText = copy;
}

function copyPlan() {
    navigator.clipboard.writeText(document.getElementById("copytext").innerText);
    alert("Copied!");
}
</script>

</body>
</html>
