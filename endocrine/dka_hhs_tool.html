<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DKA Rapid Assessment & Management</title>

<style>
:root {
    --primary:#9b5de5;
    --secondary:#f7c948;
    --bg1:#fdf7ff;
    --bg2:#f3eaff;
    --card:#ffffff;
    --text:#3a2a4c;
    --radius:14px;
}
body {
    margin:0;
    font-family:Arial,sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    padding:20px;
    color:var(--text);
}
h1 { text-align:center; color:var(--primary); }
.card {
    background:var(--card);
    border-radius:var(--radius);
    padding:20px;
    max-width:650px;
    margin:auto;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
label { font-weight:bold; margin-top:10px; display:block; }
input {
    width:100%;
    padding:10px;
    border-radius:var(--radius);
    border:1px solid #ccc;
    margin-top:5px;
}
button {
    width:100%;
    margin-top:20px;
    padding:14px;
    background:var(--primary);
    color:white;
    font-size:18px;
    border:none;
    border-radius:var(--radius);
    cursor:pointer;
}
.output {
    white-space:pre-line;
    background:#fff7e6;
    padding:14px;
    border-left:5px solid var(--secondary);
    border-radius:var(--radius);
    margin-top:10px;
}
</style>
</head>

<body>

<h1>DKA Rapid Assessment & Management</h1>

<div class="card">

<label>pH</label><input id="ph" type="number" step="0.01">
<label>HCO₃⁻ (mEq/L)</label><input id="hco3" type="number">
<label>Glucose (mg/dL)</label><input id="glucose" type="number">
<label>Sodium (mEq/L)</label><input id="na" type="number">

<label>Chloride (mEq/L) <span style="font-weight:normal">(optional)</span></label>
<input id="cl" type="number">

<label>Anion Gap (reported by lab) <span style="font-weight:normal">(optional)</span></label>
<input id="ag_lab" type="number">

<label>Potassium (mEq/L)</label><input id="k" type="number" step="0.1">
<label>β-Hydroxybutyrate (mmol/L)</label><input id="bhb" type="number" step="0.1">
<label>Serum Osmolality</label><input id="osm" type="number">
<label>Albumin (optional)</label><input id="albumin" type="number" step="0.1">

<button onclick="analyze()">Analyze</button>

<h2>Assessment</h2>
<div id="assessment" class="output"></div>

<h2>Management Plan</h2>
<div id="plan" class="output"></div>

<h2>Copy-Forward Plan</h2>
<button onclick="copyPlan()">Copy to Clipboard</button>
<div id="copy" class="output"></div>

</div>

<script>
function analyze() {

const ph = parseFloat(document.getElementById("ph").value);
const hco3 = parseFloat(document.getElementById("hco3").value);
const glu = parseFloat(document.getElementById("glucose").value);
const na = parseFloat(document.getElementById("na").value);
const k = parseFloat(document.getElementById("k").value);
const bhb = parseFloat(document.getElementById("bhb").value);
const osm = parseFloat(document.getElementById("osm").value);

const clVal = document.getElementById("cl").value;
const agLabVal = document.getElementById("ag_lab").value;
const albVal = document.getElementById("albumin").value;

if ([ph,hco3,glu,na,k].some(v => isNaN(v))) {
    alert("Please enter pH, HCO₃, glucose, sodium, and potassium.");
    return;
}

const cl = clVal ? parseFloat(clVal) : null;
const agLab = agLabVal ? parseFloat(agLabVal) : null;
const alb = albVal ? parseFloat(albVal) : null;

// Corrected sodium
const corrNa = na + 1.6 * ((glu - 100) / 100);

// Anion gap logic
let agCalc = null;
let agUsed = null;
let agSource = "";

if (cl !== null) {
    agCalc = na - (cl + hco3);
}

if (agCalc !== null) {
    agUsed = agCalc;
    agSource = agLab !== null ? "Calculated (lab AG also provided)" : "Calculated";
} else if (agLab !== null) {
    agUsed = agLab;
    agSource = "Reported by lab";
}

// Corrected AG (if albumin)
let cag = null;
if (agUsed !== null && alb !== null) {
    cag = agUsed + 2.5 * (4 - alb);
}

// Severity
let severity = "Mild";
if (ph < 7.0 || hco3 < 10) severity = "Severe";
else if (ph < 7.24 || hco3 < 15) severity = "Moderate";

// Assessment
let assess = [];
assess.push(`DKA severity: ${severity}`);
assess.push(`pH ${ph}, HCO₃ ${hco3}, Glucose ${glu}`);
assess.push(`Corrected Na⁺: ${corrNa.toFixed(1)} mEq/L`);
if (agUsed !== null) assess.push(`Anion gap: ${agUsed.toFixed(1)} (${agSource})`);
if (cag !== null) assess.push(`Albumin-corrected AG: ${cag.toFixed(1)}`);
assess.push(`β-Hydroxybutyrate: ${bhb}`);
assess.push(`Serum osmolality: ${osm}`);

document.getElementById("assessment").innerText = assess.join("\n");

// Plan
let plan = [];

// Fluids
plan.push("IV Fluids:");
if (corrNa < 135) {
    plan.push("• LR or NS 1–1.5 L in first hour (low corrected Na).");
} else {
    plan.push("• After initial bolus → transition to 0.45% NS.");
}

// Potassium
plan.push("\nPotassium:");
if (k < 3.3) {
    plan.push("• K <3.3 → HOLD insulin; replete 20–30 mEq/hr.");
} else if (k <= 5.2) {
    plan.push("• Add 20–30 mEq KCl per liter of fluid.");
} else {
    plan.push("• No K replacement initially; monitor q2–4h.");
}

// Insulin
plan.push("\nInsulin:");
if (k < 3.3) {
    plan.push("• Do NOT start insulin until K ≥3.3.");
} else {
    plan.push(severity === "Mild"
        ? "• Start insulin infusion 0.05 units/kg/hr."
        : "• Start insulin infusion 0.1 units/kg/hr."
    );
}

// Glucose
if (glu < 250) {
    plan.push("\n• Glucose <250 → add D5 (D5-0.45% NS).");
}

// Bicarbonate
if (ph < 6.9) {
    plan.push("\nBicarbonate:");
    plan.push("• Consider bicarbonate infusion (ICU only).");
}

// Resolution
plan.push("\nResolution targets:");
plan.push("• Glucose <200 mg/dL");
plan.push("• HCO₃ ≥15 and pH >7.3");
plan.push("• Anion gap ≤12");

document.getElementById("plan").innerText = plan.join("\n");

// Copy
document.getElementById("copy").innerText =
`Assessment:
${assess.join("\n")}

Plan:
${plan.join("\n")}`;
}

function copyPlan() {
navigator.clipboard.writeText(document.getElementById("copy").innerText);
alert("Copied!");
}
</script>

</body>
</html>
