<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DKA Rapid Assessment & Management</title>

<style>
:root {
    --primary:#9b5de5;
    --secondary:#f7c948;
    --bg1:#fdf7ff;
    --bg2:#f3eaff;
    --card:#ffffff;
    --text:#3a2a4c;
    --radius:14px;
}
body {
    margin:0;
    font-family:Arial,sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    padding:20px;
    color:var(--text);
}
h1 { text-align:center; color:var(--primary); }
.card {
    background:var(--card);
    border-radius:var(--radius);
    padding:20px;
    max-width:650px;
    margin:auto;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
label { font-weight:bold; margin-top:10px; display:block; }
input {
    width:100%;
    padding:10px;
    border-radius:var(--radius);
    border:1px solid #ccc;
    margin-top:5px;
}
button {
    width:100%;
    margin-top:20px;
    padding:14px;
    background:var(--primary);
    color:white;
    font-size:18px;
    border:none;
    border-radius:var(--radius);
    cursor:pointer;
}
.output {
    white-space:pre-line;
    background:#fff7e6;
    padding:14px;
    border-left:5px solid var(--secondary);
    border-radius:var(--radius);
    margin-top:10px;
}
</style>
</head>

<body>

<h1>DKA Rapid Assessment & Management</h1>

<div class="card">

<label>pH</label><input id="ph" type="number" step="0.01">
<label>HCO₃⁻ (mEq/L)</label><input id="hco3" type="number">
<label>Glucose (mg/dL)</label><input id="glucose" type="number">
<label>Sodium (mEq/L)</label><input id="na" type="number">
<label>Potassium (mEq/L)</label><input id="k" type="number" step="0.1">
<label>β-Hydroxybutyrate (mmol/L)</label><input id="bhb" type="number" step="0.1">
<label>Serum Osmolality</label><input id="osm" type="number">
<label>Albumin (optional)</label><input id="albumin" type="number" step="0.1">

<button onclick="analyze()">Analyze</button>

<h2>Assessment</h2>
<div id="assessment" class="output"></div>

<h2>Management Plan</h2>
<div id="plan" class="output"></div>

<h2>Copy-Forward Plan</h2>

<button onclick="copyPlan()">Copy to Clipboard</button>
<div id="copy" class="output"></div>

</div>

<script>
function analyze() {

let ph = +ph.value, hco3 = +hco3.value, glu = +glucose.value;
let na = +document.getElementById("na").value;
let k = +document.getElementById("k").value;
let bhb = +document.getElementById("bhb").value;
let osm = +document.getElementById("osm").value;
let alb = +document.getElementById("albumin").value || null;

// Corrected sodium
let corrNa = na + 1.6 * ((glu - 100) / 100);

// Severity
let severity = "Mild";
if (ph < 7.0 || hco3 < 10) severity = "Severe";
else if (ph < 7.24 || hco3 < 15) severity = "Moderate";

let assess =
`DKA severity: ${severity}
pH ${ph}, HCO₃ ${hco3}, BHB ${bhb}
Corrected Na⁺: ${corrNa.toFixed(1)} mEq/L
Serum osmolality: ${osm}`;

let plan = [];

// Fluids
plan.push("IV Fluids:");
if (corrNa < 135) {
    plan.push("• Start isotonic fluid: LR or NS 1–1.5 L in first hour (hyponatremia).");
} else {
    plan.push("• After initial bolus → switch to 0.45% NS (corrected Na normal/high).");
}

// Potassium
plan.push("\nPotassium:");
if (k < 3.3) {
    plan.push("• K <3.3 → HOLD insulin.");
    plan.push("• Replete KCl 20–30 mEq/hr until K ≥3.3.");
} else if (k <= 5.2) {
    plan.push("• Add KCl 20–30 mEq per liter of IV fluids.");
} else {
    plan.push("• No K replacement initially; monitor q2–4h.");
}

// Insulin
plan.push("\nInsulin:");
if (k < 3.3) {
    plan.push("• DO NOT start insulin until potassium corrected.");
} else {
    if (severity === "Mild") {
        plan.push("• Start insulin infusion 0.05 units/kg/hr.");
    } else {
        plan.push("• Start insulin infusion 0.1 units/kg/hr.");
    }
}

// Glucose transition
if (glu < 250) {
    plan.push("\n• Glucose <250 → add D5 (D5-0.45% NS) and continue insulin.");
}

// Bicarbonate
if (ph < 6.9) {
    plan.push("\nBicarbonate:");
    plan.push("• pH <6.9 → consider bicarbonate infusion in ICU.");
    plan.push("• Avoid bicarbonate otherwise (no benefit, risk hypokalemia).");
}

// Resolution criteria
plan.push("\nResolution targets:");
plan.push("• Glucose <200 mg/dL");
plan.push("• HCO₃ ≥15, pH >7.3");
plan.push("• Closed anion gap");

// Output
document.getElementById("assessment").innerText = assess;
document.getElementById("plan").innerText = plan.join("\n");

document.getElementById("copy").innerText =
`Assessment:
${assess}

Plan:
${plan.join("\n")}`;
}

function copyPlan() {
navigator.clipboard.writeText(document.getElementById("copy").innerText);
alert("Plan copied to clipboard");
}
</script>

</body>
</html>
