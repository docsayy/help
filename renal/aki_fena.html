<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AKI Staging & FENa / FEUrea / FEuric Helper</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#f4f7fb;
      --card:#ffffff;
      --accent:#0f766e;
      --accent-soft:#e0f2f1;
      --border:#d1d5db;
      --muted:#6b7280;
      --danger:#b91c1c;
      --success:#15803d;
      --radius:14px;
      --pad:14px;
      --shadow:0 10px 25px rgba(15,118,110,0.10);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:radial-gradient(circle at top left,#e0f2fe,#f4f7fb 40%,#fdfefe 80%);
      color:#0f172a;
    }
    .app{
      max-width:1100px;
      margin:0 auto;
      padding:16px 12px 24px;
    }
    header{
      text-align:center;
      margin-bottom:16px;
    }
    header h1{
      font-size:1.35rem;
      margin:0;
      letter-spacing:0.02em;
    }
    header p{
      margin:4px 0 0;
      font-size:0.85rem;
      color:var(--muted);
    }
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:14px;
    }
    @media(min-width:900px){
      .grid{
        grid-template-columns:1.1fr 1fr;
        align-items:flex-start;
      }
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:var(--pad);
      box-shadow:var(--shadow);
      border:1px solid var(--border);
    }
    .card h2{
      margin:0 0 8px;
      font-size:1rem;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .badge{
      font-size:0.65rem;
      text-transform:uppercase;
      letter-spacing:0.08em;
      background:var(--accent-soft);
      color:var(--accent);
      padding:2px 8px;
      border-radius:999px;
    }
    .section-note{
      font-size:0.75rem;
      color:var(--muted);
      margin-bottom:6px;
    }
    .field-group{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
      margin-bottom:8px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:3px;
    }
    label{
      font-size:0.78rem;
      color:#0f172a;
    }
    label span.hint{
      color:var(--muted);
      font-size:0.72rem;
      font-weight:400;
    }
    input, select{
      border-radius:8px;
      border:1px solid var(--border);
      padding:6px 8px;
      font-size:0.8rem;
      background:#f9fafb;
    }
    input:focus, select:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(15,118,110,0.25);
      background:#ffffff;
    }
    .inline{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:6px;
      flex-wrap:wrap;
    }
    .inline label{
      display:flex;
      align-items:center;
      gap:4px;
      font-size:0.78rem;
      color:var(--muted);
    }
    .inline input[type="checkbox"]{
      width:auto;
      padding:0;
    }
    .btn-row{
      margin:10px 0 2px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:flex-end;
    }
    button{
      border-radius:999px;
      border:none;
      padding:8px 16px;
      font-size:0.8rem;
      cursor:pointer;
      display:inline-flex;
      gap:6px;
      align-items:center;
      transition:transform 0.08s ease, box-shadow 0.08s ease, background 0.1s;
    }
    .btn-primary{
      background:var(--accent);
      color:white;
      box-shadow:0 6px 16px rgba(15,118,110,0.30);
    }
    .btn-primary:hover{
      transform:translateY(-1px);
      box-shadow:0 10px 25px rgba(15,118,110,0.45);
    }
    .btn-ghost{
      background:transparent;
      color:var(--muted);
      border:1px solid var(--border);
    }
    .btn-ghost:hover{
      background:#f3f4f6;
    }
    .results{
      display:flex;
      flex-direction:column;
      gap:8px;
      font-size:0.8rem;
    }
    .result-block{
      padding:8px 10px;
      border-radius:10px;
      background:#f9fafb;
      border:1px solid #e5e7eb;
    }
    .result-title{
      font-weight:600;
      margin-bottom:2px;
    }
    .pill-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:4px;
    }
    .pill{
      padding:2px 8px;
      font-size:0.72rem;
      border-radius:999px;
      background:var(--accent-soft);
      color:var(--accent);
    }
    .pill-danger{
      background:#fee2e2;
      color:var(--danger);
    }
    .pill-success{
      background:#dcfce7;
      color:var(--success);
    }
    .etiology-main{
      font-weight:600;
      margin-bottom:3px;
    }
    .small{
      font-size:0.74rem;
      color:var(--muted);
    }
    .copy-status{
      font-size:0.75rem;
      color:var(--muted);
      margin-top:4px;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <h1>AKI Staging & Fractional Excretion Tool</h1>
    <p>FENa Â· FEUrea Â· FEuric + KDIGO stage + simple prerenal/intrinsic/postrenal suggestion</p>
  </header>

  <div class="grid">
    <!-- INPUTS -->
    <div class="card">
      <h2>
        Inputs
        <span class="badge">Labs & Clinical</span>
      </h2>
      <p class="section-note">
        Enter what you have; missing fields will be skipped in calculations.
      </p>

      <div class="field-group">
        <div class="field">
          <label for="scr">Current serum creatinine (mg/dL)</label>
          <input id="scr" type="number" step="0.01" />
        </div>
        <div class="field">
          <label for="scr_baseline">Baseline serum creatinine (mg/dL) <span class="hint">(if known)</span></label>
          <input id="scr_baseline" type="number" step="0.01" />
        </div>
      </div>

      <div class="field-group">
        <div class="field">
          <label for="bun">BUN (mg/dL) <span class="hint">(optional)</span></label>
          <input id="bun" type="number" step="0.1" />
        </div>
        <div class="field">
          <label for="sna">Serum Na (mEq/L)</label>
          <input id="sna" type="number" step="0.1" />
        </div>
      </div>

      <div class="field-group">
        <div class="field">
          <label for="surea">Serum urea nitrogen (BUN) (mg/dL) <span class="hint">(for FEUrea)</span></label>
          <input id="surea" type="number" step="0.1" />
        </div>
        <div class="field">
          <label for="suric">Serum uric acid (mg/dL) <span class="hint">(for FEuric, optional)</span></label>
          <input id="suric" type="number" step="0.1" />
        </div>
      </div>

      <hr style="border:none;border-top:1px dashed #e5e7eb;margin:6px 0 10px" />

      <p class="section-note"><strong>Urine values</strong></p>

      <div class="field-group">
        <div class="field">
          <label for="una">Urine Na (mEq/L)</label>
          <input id="una" type="number" step="0.1" />
        </div>
        <div class="field">
          <label for="ucre">Urine creatinine (mg/dL)</label>
          <input id="ucre" type="number" step="0.1" />
        </div>
      </div>

      <div class="field-group">
        <div class="field">
          <label for="uurea">Urine urea nitrogen (mg/dL) <span class="hint">(for FEUrea)</span></label>
          <input id="uurea" type="number" step="0.1" />
        </div>
        <div class="field">
          <label for="uuric">Urine uric acid (mg/dL) <span class="hint">(for FEuric, optional)</span></label>
          <input id="uuric" type="number" step="0.1" />
        </div>
      </div>

      <hr style="border:none;border-top:1px dashed #e5e7eb;margin:6px 0 10px" />

      <p class="section-note"><strong>Clinical clues</strong></p>

      <div class="inline">
        <label>
          <input id="on_diuretics" type="checkbox" />
          On diuretics (loop/thiazide)?
        </label>
        <label>
          <input id="obstruction" type="checkbox" />
          Known / suspected obstruction?
        </label>
        <label>
          <input id="anuric" type="checkbox" />
          Anuric (&lt;100 mL/day)?
        </label>
      </div>

      <div class="btn-row">
        <button class="btn-ghost" type="button" onclick="resetForm()">Clear</button>
        <button class="btn-primary" type="button" onclick="calculateAll()">
          â–¶ï¸Ž Calculate
        </button>
      </div>
    </div>

    <!-- OUTPUTS -->
    <div class="card">
      <h2>
        Results
        <span class="badge">Interpretation</span>
      </h2>
      <p class="section-note">
        These are for educational decision support; always correlate with the full clinical picture.
      </p>

      <div class="results" id="results-region">
        <div class="result-block">
          <div class="result-title">Fractional Excretion</div>
          <div id="fe-results">No values yet.</div>
          <div class="pill-row" id="fe-pill-row"></div>
        </div>

        <div class="result-block">
          <div class="result-title">AKI Stage (KDIGO â€“ creatinine only)</div>
          <div id="aki-stage">Baseline or current creatinine missing.</div>
          <div class="pill-row" id="aki-pill-row"></div>
        </div>

        <div class="result-block">
          <div class="result-title">Likely Etiology</div>
          <div id="etiology-main" class="etiology-main">Insufficient data.</div>
          <div id="etiology-details"></div>
        </div>

        <div class="result-block">
          <div class="result-title">Summary (Copy-ready)</div>
          <div id="summary-text" class="small">
            No summary yet. Enter values and click Calculate.
          </div>
          <button class="btn-ghost" type="button" onclick="copySummary()">
            ðŸ“‹ Copy summary
          </button>
          <div id="copy-status" class="copy-status"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function parseNum(id){
  const v = parseFloat(document.getElementById(id).value);
  return isNaN(v) ? null : v;
}

function round(val, digits=1){
  if(val === null || val === undefined || isNaN(val)) return null;
  const f = Math.pow(10,digits);
  return Math.round(val*f)/f;
}

function calcFENa(una, sna, ucre, scr){
  if([una,sna,ucre,scr].some(v => v === null || v === 0)) return null;
  return (una * scr) / (sna * ucre) * 100;
}

function calcFEUrea(uurea, surea, ucre, scr){
  if([uurea,surea,ucre,scr].some(v => v === null || v === 0)) return null;
  return (uurea * scr) / (surea * ucre) * 100;
}

function calcFEuric(uuric, suric, ucre, scr){
  if([uuric,suric,ucre,scr].some(v => v === null || v === 0)) return null;
  return (uuric * scr) / (suric * ucre) * 100;
}

function akiStageKdigo(scr, baseline){
  if(scr === null || baseline === null || baseline <= 0) return {stage:null, text:"Cannot stage: baseline or current creatinine missing/invalid."};
  const ratio = scr / baseline;
  if(ratio < 1.5 && (scr - baseline) < 0.3){
    return {stage:0, text:`No KDIGO AKI by creatinine (ratio ${ratio.toFixed(2)}).`};
  }else if((scr - baseline) >= 0.3 && ratio < 1.5){
    return {stage:1, text:`Stage 1 AKI: â†‘Cr â‰¥0.3 mg/dL (ratio ${ratio.toFixed(2)}).`};
  }else if(ratio >= 1.5 && ratio < 2){
    return {stage:1, text:`Stage 1 AKI: 1.5â€“1.9Ã— baseline (ratio ${ratio.toFixed(2)}).`};
  }else if(ratio >= 2 && ratio < 3){
    return {stage:2, text:`Stage 2 AKI: 2.0â€“2.9Ã— baseline (ratio ${ratio.toFixed(2)}).`};
  }else if(ratio >= 3 || scr >= 4){
    return {stage:3, text:`Stage 3 AKI: â‰¥3Ã— baseline or Cr â‰¥4 mg/dL (ratio ${ratio.toFixed(2)}).`};
  }else{
    return {stage:null, text:`Cannot categorize clearly (ratio ${ratio.toFixed(2)}).`};
  }
}

function buildEtiology(feNa, feUrea, feUric, onDiuretics, obstruction, anuric){
  // text + details
  if(obstruction){
    return {
      main: "Postrenal AKI most likely.",
      details: "Obstruction flag is checked. Confirm with bladder scan and renal ultrasound; relieve obstruction urgently if present."
    };
  }

  if(anuric){
    return {
      main: "Severe AKI with anuria.",
      details: "Anuria can be seen in severe intrinsic AKI, arterial/venous occlusion, or complete obstruction. Urgent nephrology input is recommended."
    };
  }

  let main = "Etiology indeterminate.";
  let pieces = [];

  if(onDiuretics){
    pieces.push("On diuretics: FEUrea/FEuric are more reliable than FENa.");
    if(feUrea !== null){
      if(feUrea < 35){
        main = "Prerenal physiology favored (on diuretics).";
        pieces.push("FEUrea <35% suggests prerenal state (e.g., hypovolemia, effective volume depletion).");
      }else if(feUrea > 50){
        main = "Intrinsic AKI favored (on diuretics).";
        pieces.push("FEUrea >50% suggests intrinsic tubular injury (e.g., ATN).");
      }
    }
    if(feUric !== null){
      if(feUric < 10){
        pieces.push("FEuric <10% supports prerenal physiology.");
      }else if(feUric > 10){
        pieces.push("FEuric >10% supports intrinsic tubular injury.");
      }
    }
  }else{
    // Not on diuretics: use FENa primarily
    if(feNa !== null){
      if(feNa < 1){
        main = "Prerenal AKI favored.";
        pieces.push("FENa <1% suggests prerenal state (volume depletion, low effective arterial volume).");
      }else if(feNa > 2){
        main = "Intrinsic AKI favored.";
        pieces.push("FENa >2% suggests intrinsic tubular injury (e.g., ATN).");
      }else{
        pieces.push("FENa 1â€“2% is gray zone; correlate with exam and urine sediment.");
      }
    }
    // Use FEUrea/FEuric as supportive if available
    if(feUrea !== null){
      if(feUrea < 35){
        pieces.push("FEUrea <35% supports prerenal physiology.");
      }else if(feUrea > 50){
        pieces.push("FEUrea >50% supports intrinsic tubular injury.");
      }
    }
    if(feUric !== null){
      if(feUric < 10){
        pieces.push("FEuric <10% supports prerenal physiology.");
      }else if(feUric > 10){
        pieces.push("FEuric >10% supports intrinsic tubular injury.");
      }
    }
  }

  if(pieces.length === 0){
    pieces.push("Insufficient fractional excretion data to label prerenal vs intrinsic. Consider volume status, urine sediment, ultrasound.");
  }

  return {
    main: main,
    details: pieces.join(" ")
  };
}

function calculateAll(){
  const scr = parseNum("scr");
  const baseline = parseNum("scr_baseline");
  const bun = parseNum("bun");
  const sna = parseNum("sna");
  const surea = parseNum("surea");
  const suric = parseNum("suric");
  const una = parseNum("una");
  const ucre = parseNum("ucre");
  const uurea = parseNum("uurea");
  const uuric = parseNum("uuric");
  const onDiuretics = document.getElementById("on_diuretics").checked;
  const obstruction = document.getElementById("obstruction").checked;
  const anuric = document.getElementById("anuric").checked;

  const feNa = calcFENa(una, sna, ucre, scr);
  const feUrea = calcFEUrea(uurea, surea, ucre, scr);
  const feUric = calcFEuric(uuric, suric, ucre, scr);

  const feResultsDiv = document.getElementById("fe-results");
  const fePills = document.getElementById("fe-pill-row");
  fePills.innerHTML = "";

  let feLines = [];
  if(feNa !== null){
    feLines.push(`FENa: ${round(feNa,1)}%`);
    const pill = document.createElement("span");
    pill.className = "pill";
    pill.textContent = `FENa ${round(feNa,1)}%`;
    fePills.appendChild(pill);
  }
  if(feUrea !== null){
    feLines.push(`FEUrea: ${round(feUrea,1)}%`);
    const pill = document.createElement("span");
    pill.className = "pill";
    pill.textContent = `FEUrea ${round(feUrea,1)}%`;
    fePills.appendChild(pill);
  }
  if(feUric !== null){
    feLines.push(`FEuric: ${round(feUric,1)}%`);
    const pill = document.createElement("span");
    pill.className = "pill";
    pill.textContent = `FEuric ${round(feUric,1)}%`;
    fePills.appendChild(pill);
  }
  if(bun !== null && scr !== null){
    feLines.push(`BUN:Cr â‰ˆ ${round(bun/scr,1)}`);
  }

  if(feLines.length === 0){
    feResultsDiv.textContent = "No fractional excretion values calculated. Enter serum + urine data.";
  }else{
    feResultsDiv.innerHTML = feLines.join("<br>");
  }

  // AKI stage
  const aki = akiStageKdigo(scr, baseline);
  const akiDiv = document.getElementById("aki-stage");
  const akiPills = document.getElementById("aki-pill-row");
  akiPills.innerHTML = "";
  akiDiv.textContent = aki.text;

  if(aki.stage !== null){
    const pill = document.createElement("span");
    pill.className = "pill";
    if(aki.stage === 0){
      pill.classList.add("pill-success");
      pill.textContent = "No AKI (by Cr)";
    }else{
      pill.textContent = `Stage ${aki.stage} AKI`;
      if(aki.stage === 3) pill.classList.add("pill-danger");
    }
    akiPills.appendChild(pill);
  }

  // Etiology
  const et = buildEtiology(feNa, feUrea, feUric, onDiuretics, obstruction, anuric);
  document.getElementById("etiology-main").textContent = et.main;
  document.getElementById("etiology-details").textContent = et.details;

  // Build summary for copy
  let summaryParts = [];
  if(scr !== null){
    summaryParts.push(`Current Cr ${scr} mg/dL`);
  }
  if(baseline !== null){
    summaryParts.push(`baseline ${baseline} mg/dL`);
  }
  if(aki.stage !== null){
    summaryParts.push(aki.text);
  }
  if(feNa !== null){
    summaryParts.push(`FENa ${round(feNa,1)}%`);
  }
  if(feUrea !== null){
    summaryParts.push(`FEUrea ${round(feUrea,1)}%`);
  }
  if(feUric !== null){
    summaryParts.push(`FEuric ${round(feUric,1)}%`);
  }
  if(bun !== null && scr !== null){
    summaryParts.push(`BUN:Cr â‰ˆ ${round(bun/scr,1)}`);
  }
  summaryParts.push(et.main);
  summaryParts.push(et.details);

  document.getElementById("summary-text").textContent = summaryParts.join(" | ");
  document.getElementById("copy-status").textContent = "";
}

function resetForm(){
  const ids = ["scr","scr_baseline","bun","sna","surea","suric","una","ucre","uurea","uuric"];
  ids.forEach(id => document.getElementById(id).value = "");
  ["on_diuretics","obstruction","anuric"].forEach(id => document.getElementById(id).checked = false);
  document.getElementById("fe-results").textContent = "No values yet.";
  document.getElementById("fe-pill-row").innerHTML = "";
  document.getElementById("aki-stage").textContent = "Baseline or current creatinine missing.";
  document.getElementById("aki-pill-row").innerHTML = "";
  document.getElementById("etiology-main").textContent = "Insufficient data.";
  document.getElementById("etiology-details").textContent = "";
  document.getElementById("summary-text").textContent = "No summary yet. Enter values and click Calculate.";
  document.getElementById("copy-status").textContent = "";
}

function copySummary(){
  const text = document.getElementById("summary-text").textContent || "";
  if(!navigator.clipboard){
    document.getElementById("copy-status").textContent = "Clipboard not available in this browser.";
    return;
  }
  navigator.clipboard.writeText(text).then(() => {
    document.getElementById("copy-status").textContent = "Summary copied to clipboard.";
  }).catch(() => {
    document.getElementById("copy-status").textContent = "Unable to copy.";
  });
}
</script>
</body>
</html>
